!function(a,b){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a):function(a){if(!a.document)throw new Error("cerosScrollProxy requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a){"use strict";var b="CEROS_SCROLL_PROXY_LOADED";if(!a[b]){a[b]=!0;var c="ceros-embedded-viewport:",d={PING:"ping",READY:"ready",POSITION:"position",SCROLL_TO:"scroll-to",GOTO_URL:"goto-url",VARIANT_DETECTION:"variant-detection",GLOBAL_FUNCTION_INVOKE:"global-function"},e="data-aspectRatio",f="data-scrollEvent-selector",g="data-ceros-origin-domains",h="ceros-experience",i=[],j=[],k=[],l=[],m=function(a){n(a),o(a),v(a)},n=function(a){var b=p(a);if(!b.getAttribute(e)){var c=t(b.style.paddingBottom);b.setAttribute(e,c),U("Defaulting to fallback aspect ratio from paddingBottom",c)}},o=function(a){var b=p(a);"true"===a.getAttribute("data-ceros-subpixel-oversize")&&(a.setAttribute("data-ceros-subpixel-oversize","false"),a.style.width=a.getAttribute("data-ceros-subpixel-original-width"),a.style.height=a.getAttribute("data-ceros-subpixel-original-height"));var c=a.getBoundingClientRect(),d=Math.ceil(c.width),e=Math.ceil(c.height);if(c.width!==d||c.height!==e){if(Math.abs(d-a.offsetWidth)>1)return void U("Frame is subpixel but skipping resize because it is scaled",a);a.setAttribute("data-ceros-subpixel-oversize","true"),a.setAttribute("data-ceros-subpixel-original-width",a.style.width),a.setAttribute("data-ceros-subpixel-original-height",a.style.height);var f=t(b.style.paddingBottom);a.style.width=d+"px",a.style.height=Math.ceil(d/f)+"px",U("Frame size was subpixel, adjusted to next whole pixel")}},p=function(a){return a.parentElement},q=function(a,b){var c=p(a),d="desktop"===b?"data-aspectRatio":"data-"+b+"-aspectRatio",f=c.getAttribute(d);return f||(f=c.getAttribute(e)),f?+f:null},r=function(a,b){var c=q(a,b);c&&s(a,c)},s=function(a,b){var c=p(a);t(c.style.paddingBottom)!==b&&(c.style.paddingBottom=u(b),U("Updated aspect ratio to",b),C())},t=function(a){return 100/parseFloat(a)},u=function(a){return(100/a).toFixed(2)+"%"},v=function(b){var c=x(b);if(c){var d=a.document.querySelector(c);if(d){var e=function(){y(b)};k.push({frame:b,element:d,handler:e}),d.addEventListener("scroll",e),U("Registered custom scroll listener on",d,"for",b)}else V("No element found for scroll broadcast selector",c)}},w=function(a){for(var b=0;b<k.length;b++){var c=k[b];if(c.frame===a)return c.element.removeEventListener("scroll",c.handler),void k.splice(b,1)}},x=function(b){var c=b.getAttribute(f);return c||!!a.cerosScrollEventSelector&&a.cerosScrollEventSelector},y=function(b){var c=b.getBoundingClientRect(),e=z(),f=A(),g={top:-c.top,bottom:a.innerHeight-c.top,windowWidth:e.width,windowHeight:e.height,screenWidth:f.width,screenHeight:f.height};L(b,d.POSITION,g)},z=function(){var b=A(),c=b.width&&b.width<a.innerWidth;return{width:c?b.width:a.innerWidth,height:c?b.height:a.innerHeight}},A=function(){return{width:a.cerosScreenDimensions?a.cerosScreenDimensions.width:a.screen.width,height:a.cerosScreenDimensions?a.cerosScreenDimensions.height:a.screen.height}},B=function(){for(var a=0;a<i.length;a++)y(i[a])},C=function(){for(var a=0;a<i.length;a++){var b=i[a];o(b),y(b)}},D=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.contentWindow===b)return d}return null},E=function(b){var c=D(a.document.getElementsByTagName("iframe"),b);c&&(U("Received ready event from frame",c),m(c),i.push(c),y(c))},F=function(b,c){var d=D(i,b);if(d){var e=Math.max(0,c.scrollPosition-c.pageHeight+c.visibleHeight),f=d.getBoundingClientRect(),g=a.pageYOffset+f.top,h=a.pageYOffset+f.bottom,j=f.bottom-f.top,k=e*j/c.visibleHeight,l=h-a.innerHeight;a.scroll(0,Math.min(k+g,l))}},G=function(b,c){c.url&&0===c.url.trim().toLowerCase().indexOf("javascript:")||(c.urlOpenInNewWindow?a.open(c.url):a.location=c.url)},H=function(a,b){var c=D(i,a);c&&r(c,b.variant)},I=function(b){if(!b||!b.functionPath)return!1;if(-1===["ga","gtag","dataLayer.push"].indexOf(b.functionPath))return!1;for(var c=Array.isArray(b.args)?b.args:[],d=a,e=null,f=b.functionPath.split("."),g=0;g<f.length&&(g>0&&(d=e),e=d[f[g]]);g++);return!(!d||!e||"function"!=typeof e)&&function(){return e.apply(d,c)}},J=function(a){if(Array.isArray(a))for(var b=0;b<a.length;b++){var c=I(a[b]);if(c){c();break}}},K=function(a){var b,e;if($(a.origin)&&_(a.source)){try{b=JSON.parse(a.data),e=b&&b.event&&b.event.substr(0,c.length)===c}catch(f){return}if(e)switch(b.event.substr(c.length)){case d.READY:E(a.source);break;case d.SCROLL_TO:F(a.source,b);break;case d.GOTO_URL:G(a.source,b);break;case d.VARIANT_DETECTION:H(a.source,b);break;case d.GLOBAL_FUNCTION_INVOKE:b&&b.globalFunctions&&J(b.globalFunctions)}}},L=function(a,b,d){var e={event:c+b};if(d)for(var f in d)d.hasOwnProperty(f)&&(e[f]=d[f]);var g=JSON.stringify(e);a.contentWindow.postMessage(g,"*")},M=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.getAttribute("class");d&&-1!==d.indexOf(h)&&N(c)}},N=function(a){var b=-1!==j.indexOf(a),c=a.contentWindow&&"function"==typeof a.contentWindow.postMessage;!b&&c&&(L(a,d.PING),j.push(a),U("Registered frame",a))},O=function(a){for(var b=0;b<a.length;b++)P(a[b])},P=function(a){var b=j.indexOf(a);if(-1!==b){var c=i.indexOf(a);-1!==c&&(w(a),i.splice(c,1)),j.splice(b,1),U("Unregistered frame",a.src)}},Q=function(){var b=a.document.getElementsByTagName("iframe");M(b)},R=function(a){for(var b=0;b<a.length;b++){var c=a[b];"childList"===c.type&&(S(c.addedNodes),T(c.removedNodes))}},S=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=[];if("IFRAME"===c.nodeName)d.push(c);else if("function"==typeof c.getElementsByTagName){var e=c.getElementsByTagName("iframe");Array.prototype.push.apply(d,e)}M(d)}},T=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=[];if("IFRAME"===c.nodeName)d.push(c);else if("function"==typeof c.getElementsByTagName){var e=c.getElementsByTagName("iframe");Array.prototype.push.apply(d,e)}O(d)}},U=function(){a.console&&a.console.debug&&a.console.debug.apply(a.console,arguments)},V=function(){a.console&&a.console.warn&&a.console.warn.apply(a.console,arguments)},W=function(){if(MutationObserver&&a.document){new MutationObserver(R).observe(a.document,{childList:!0,subtree:!0})}},X=function(b){if("complete"===a.document.readyState||"loading"!==a.document.readyState&&!a.document.documentElement.doScroll)b();else{var c=function(){a.document.removeEventListener("DOMContentLoaded",c),b()};a.document.addEventListener("DOMContentLoaded",c)}},Y=function(a){var b=[];if(a)for(var c=a.split(","),d=0;d<c.length;d++)b.push(c[d].trim().toLowerCase());return b},Z=function(){for(var a=[],b=document.querySelectorAll("script["+g+"]"),c=0;c<b.length;c++){var d=b[c].getAttribute(g);a=a.concat(Y(d))}return a},$=function(a){if(0===l.length)return!0;if(!a)return!1;for(var b=a.replace(/^https?:\/\//,""),c=0;c<l.length;c++)if(l[c]===b.toLowerCase())return!0;return!1},_=function(a){return null!==D(j,a)},aa={registerFrame:N,unregisterFrame:P,sendViewportPositionEvent:y};return"function"==typeof define&&define.amd&&define("cerosScrollProxy",[],function(){return aa}),a.sendViewportPositionEvent=y,Q(),X(function(){W(),Q()}),l=Z(),a.addEventListener("message",K),a.addEventListener("scroll",B),a.addEventListener("resize",C),aa}});